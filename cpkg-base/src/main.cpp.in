
#include "Compiler.hpp"
#include <Workspace.hpp>
#include <Package.hpp>
#include <Toolchain.hpp>
#include <Variant.hpp>

#include <fstream>

auto emit_sources(const Package& package) {
    auto sources = std::get<std::deque<Variant>>(package.sources);

    std::fstream metadata("compile-comands.json");
    print(metadata, sources);

}

int main(int argc, char* argv[])
{
    std::deque<std::string> args(argv, argv + argc);
    Compiler current_compiler;

    if (args[1] == "--emit-manifest") {
        std::fstream stream(".workspace.manifest.json");
        print(stream, workspace);

    }

    for (const auto& target : workspace.targets) {
        current_compiler.build(target);
    }

    return 0;
}